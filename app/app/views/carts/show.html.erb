<div class="container">
  <h1 class="mb-4"><i class="bi bi-cart3 me-2"></i>My Cart</h1>

  <% if @cart_items.empty? %>
    <div class="alert alert-liquid-info">Your cart is empty.</div>
    <%= link_to "Back to shop", shop_path, class: "btn btn-liquid-primary" %>
  <% else %>
    <div class="table-responsive mb-3">
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Product</th>
            <th>Variant</th>
            <th class="text-end">Unit</th>
            <th class="text-center">Qty</th>
            <th class="text-end">Subtotal</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @cart_items.each do |ci| %>
            <tr>
              <td><%= ci[:product].name %></td>
              <td><%= ci[:variant].sku %></td>
              <td class="text-end"><%= number_to_currency(ci[:unit_price_cents] / 100.0, unit: "€") %></td>
              <td class="text-center" style="width: 140px;">
                <%= form_with url: update_item_cart_path, method: :patch, class: "d-inline" do |f| %>
                  <%= hidden_field_tag :variant_id, ci[:variant].id %>
                  <div class="input-group input-group-sm">
                    <%= number_field_tag :quantity, ci[:quantity], min: 0, class: "form-control" %>
                    <button class="btn btn-outline-primary" type="submit">Update</button>
                  </div>
                <% end %>
              </td>
              <td class="text-end"><%= number_to_currency(ci[:subtotal_cents] / 100.0, unit: "€") %></td>
              <td class="text-end">
                <%= button_to "Remove", remove_item_cart_path(variant_id: ci[:variant].id), method: :delete, class: "btn btn-outline-danger btn-sm" %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>

    <div class="d-flex justify-content-between align-items-center">
      <%= button_to "Clear cart", clear_cart_path, method: :delete, class: "btn btn-outline-secondary" %>
      <h4 class="mb-0">Total: <%= number_to_currency(@total_cents / 100.0, unit: "€") %></h4>
    </div>

    <div class="mt-3 d-flex gap-2">
      <%= link_to "Continue shopping", shop_path, class: "btn btn-outline-primary" %>
      <%= link_to "Checkout (coming soon)", "#", class: "btn btn-liquid-primary disabled" %>
    </div>
  <% end %>
</div>


