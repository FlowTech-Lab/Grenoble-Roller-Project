<%# Partial partagé pour les actions d'un événement (Event ou Event::Initiation) %>
<%# Variables attendues: event (peut être Event ou Event::Initiation), user_attendance (optionnel), child_attendances (optionnel) %>

<div class="event-actions-sticky">
  <!-- Notification rappel (uniquement si inscrit) -->
  <% if local_assigns[:user_attendance] || local_assigns[:child_attendances]&.any? %>
    <% any_reminder_active = (local_assigns[:user_attendance]&.wants_reminder? || local_assigns[:child_attendances]&.any? { |a| a.wants_reminder? }) %>
    <% if any_reminder_active %>
      <div class="alert alert-info alert-reminder mb-3 border-start border-info border-4" role="alert">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <i class="bi bi-bell-fill me-2 text-info" aria-hidden="true"></i>
            <strong>Rappel activé</strong>
            <p class="mb-0 small text-muted">Vous recevrez un email la veille à 19h pour vous rappeler <%= event.is_a?(Event::Initiation) ? "la séance" : "l'événement" %>.</p>
          </div>
          <%= button_to toggle_reminder_event_path_for(event), method: :patch, 
              class: "btn btn-outline-secondary btn-sm", 
              data: { turbo: false },
              aria: { label: 'Désactiver le rappel' } do %>
            <i class="bi bi-bell-slash me-1" aria-hidden="true"></i>Désactiver le rappel
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="alert alert-light border border-warning mb-3" role="alert">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <i class="bi bi-bell me-2 text-warning" aria-hidden="true"></i>
            <strong>Rappel désactivé</strong>
            <p class="mb-0 small text-muted">Activez le rappel pour recevoir un email la veille à 19h.</p>
          </div>
          <%= button_to toggle_reminder_event_path_for(event), method: :patch, 
              class: "btn btn-outline-primary btn-sm", 
              data: { turbo: false },
              aria: { label: 'Activer le rappel' } do %>
            <i class="bi bi-bell-plus me-1" aria-hidden="true"></i>Activer le rappel
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>

  <!-- Boutons secondaires (Calendrier en premier) -->
  <div class="secondary-actions mb-3">
    <% if user_signed_in? %>
      <%= link_to ical_event_path_for(event), 
          class: 'btn btn-outline-primary btn-sm', 
          title: 'Télécharger le fichier .ics pour l\'ajouter à votre calendrier', 
          aria: { label: 'Ajouter au calendrier' } do %>
        <i class="bi bi-calendar-event me-1" aria-hidden="true"></i>Calendrier
      <% end %>
    <% else %>
      <%= link_to new_user_session_path, 
          class: 'btn btn-outline-primary btn-sm',
          aria: { label: 'Se connecter pour accéder aux fonctionnalités' } do %>
        <i class="bi bi-box-arrow-in-right me-1" aria-hidden="true"></i>Connexion
      <% end %>
    <% end %>
  </div>

  <!-- Boutons secondaires (retour à la liste) -->
  <div class="secondary-actions">
    <%= link_to events_index_path_for(event), 
        class: 'btn btn-outline-secondary btn-sm',
        aria: { label: events_index_label_for(event) } do %>
      <i class="bi bi-calendar-event me-1" aria-hidden="true"></i><%= events_index_label_for(event) %>
    <% end %>
  </div>

  <!-- Boutons tertiaires (Modifier / Supprimer) -->
  <% if policy(event).edit? || policy(event).destroy? %>
    <div class="tertiary-actions">
      <% if policy(event).edit? %>
        <%= link_to edit_event_path_for(event), 
            class: 'btn btn-link text-decoration-none btn-sm',
            aria: { label: "Modifier #{event.is_a?(Event::Initiation) ? 'cette initiation' : 'cet événement'}" } do %>
          <i class="bi bi-pencil-square me-1" aria-hidden="true"></i>Modifier
        <% end %>
      <% end %>

      <% if policy(event).destroy? %>
        <button type="button" 
                class="btn btn-link text-danger text-decoration-none btn-sm" 
                data-bs-toggle="modal" 
                data-bs-target="#confirmDeleteModalShow"
                aria-label="Supprimer <%= event.is_a?(Event::Initiation) ? 'cette initiation' : 'cet événement' %>">
          <i class="bi bi-trash me-1" aria-hidden="true"></i>Supprimer
        </button>
      <% end %>
    </div>
  <% end %>
</div>

