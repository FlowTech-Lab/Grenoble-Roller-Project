<% 
  # Structure du menu hiérarchique selon guide-ux-ui.md et inventaire-active-admin.md
  # Menu items avec structure complète
%>

<!-- SIDEBAR: Desktop/Tablet (hidden on mobile) -->
<aside class="d-none d-lg-flex flex-column bg-dark text-white border-end" 
       id="sidebar" 
       data-admin-sidebar-target="sidebar"
       data-controller="admin-sidebar"
       style="width: 280px; transition: width 300ms ease;">
  
  <!-- Header avec logo/titre -->
  <div class="p-3 border-bottom border-secondary d-flex align-items-center justify-content-between">
    <span class="d-inline fw-bold" id="sidebar-logo-text">Grenoble Roller</span>
    <button class="btn btn-sm btn-outline-light d-none d-lg-block"
            data-action="click->admin-sidebar#toggle"
            aria-label="Réduire la sidebar">
      <i class="bi bi-chevron-left"></i>
    </button>
  </div>

  <!-- Navigation menu -->
  <nav class="flex-grow-1 overflow-y-auto px-2 py-3">
    <ul class="nav nav-pills flex-column gap-2">
      
      <!-- TABLEAU DE BORD (level >= 60 uniquement) -->
      <% if current_user&.role&.level.to_i >= 60 %>
        <li class="nav-item">
          <%= link_to admin_panel_root_path, 
              class: "nav-link d-flex align-items-center gap-2 #{'active' if controller_name == 'dashboard' && controller.class.name.start_with?('AdminPanel::')}",
              title: "Tableau de bord",
              data: { tooltip_placement: "right" } do %>
            <i class="bi bi-speedometer2 fs-5"></i>
            <span class="sidebar-label">Tableau de bord</span>
          <% end %>
        </li>
      <% end %>

      <!-- INITIATIONS (level >= 30 : INITIATION, ORGANIZER, MODERATOR, ADMIN, SUPERADMIN) -->
      <% if current_user&.role&.level.to_i >= 30 %>
        <li class="nav-item">
          <%= link_to admin_panel_initiations_path, 
              class: "nav-link d-flex align-items-center gap-2 #{'active' if controller_name == 'initiations' && controller.class.name.start_with?('AdminPanel::')}",
              title: "Initiations",
              data: { tooltip_placement: "right" } do %>
            <i class="bi bi-people fs-5"></i>
            <span class="sidebar-label">Initiations</span>
          <% end %>
        </li>
      <% end %>

      <!-- COMMANDES (level >= 60 uniquement) -->
      <% if current_user&.role&.level.to_i >= 60 %>
        <li class="nav-item">
          <%= link_to admin_panel_orders_path, 
              class: "nav-link d-flex align-items-center gap-2 #{'active' if controller_name == 'orders' && controller.class.name.start_with?('AdminPanel::')}",
              title: "Commandes",
              data: { tooltip_placement: "right" } do %>
            <i class="bi bi-box-seam fs-5"></i>
            <span class="sidebar-label">Commandes</span>
          <% end %>
        </li>
      <% end %>

      <!-- SÉPARATEUR -->
      <li class="nav-item">
        <hr class="border-secondary my-2">
      </li>

      <!-- ACTIVEADMIN (Lien vers l'ancien admin) -->
      <li class="nav-item">
        <%= link_to "/activeadmin", 
            class: "nav-link d-flex align-items-center gap-2 text-warning",
            title: "ActiveAdmin (Ancien panel)",
            target: "_blank",
            data: { tooltip_placement: "right" } do %>
          <i class="bi bi-gear fs-5"></i>
          <span class="sidebar-label">ActiveAdmin</span>
          <i class="bi bi-box-arrow-up-right ms-auto small"></i>
        <% end %>
      </li>

    </ul>
  </nav>

  <!-- Footer -->
  <div class="p-3 border-top border-secondary">
    <div class="small text-muted">
      <div class="sidebar-label"><%= current_user.email %></div>
      <%= link_to destroy_user_session_path, method: :delete, 
          class: "text-white-50 text-decoration-none small sidebar-label",
          data: { bs_dismiss: "" } do %>
        <i class="bi bi-box-arrow-right me-1"></i>Déconnexion
      <% end %>
    </div>
  </div>
</aside>

<!-- OFFCANVAS: Mobile only -->
<div class="offcanvas offcanvas-start bg-dark text-white" 
     tabindex="-1" 
     id="offcanvasSidebar" 
     aria-labelledby="offcanvasSidebarLabel"
     data-bs-backdrop="true"
     data-bs-scroll="false">
  <div class="offcanvas-header border-bottom border-secondary">
    <h5 class="offcanvas-title" id="offcanvasSidebarLabel">Menu</h5>
    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Fermer"></button>
  </div>
  <div class="offcanvas-body p-0">
    <!-- Même menu navigation (cloner la structure) -->
    <nav class="py-3">
      <ul class="nav nav-pills flex-column gap-2 px-2">
        <% if current_user&.role&.level.to_i >= 60 %>
          <li class="nav-item">
            <%= link_to admin_panel_root_path, 
                class: "nav-link #{'active' if controller_name == 'dashboard' && controller.class.name.start_with?('AdminPanel::')}", 
                data: { bs_dismiss: "offcanvas" } do %>
              <i class="bi bi-speedometer2 me-2"></i>Tableau de bord
            <% end %>
          </li>
        <% end %>
        <% if current_user&.role&.level.to_i >= 30 %>
          <li class="nav-item">
            <%= link_to admin_panel_initiations_path, 
                class: "nav-link #{'active' if controller_name == 'initiations' && controller.class.name.start_with?('AdminPanel::')}", 
                data: { bs_dismiss: "offcanvas" } do %>
              <i class="bi bi-people me-2"></i>Initiations
            <% end %>
          </li>
        <% end %>
        <% if current_user&.role&.level.to_i >= 60 %>
          <li class="nav-item">
            <%= link_to admin_panel_orders_path, 
                class: "nav-link #{'active' if controller_name == 'orders' && controller.class.name.start_with?('AdminPanel::')}", 
                data: { bs_dismiss: "offcanvas" } do %>
              <i class="bi bi-box-seam me-2"></i>Commandes
            <% end %>
          </li>
        <% end %>
        <li class="nav-item">
          <hr class="border-secondary my-2">
        </li>
        <li class="nav-item">
          <%= link_to "/activeadmin", 
              class: "nav-link text-warning", 
              target: "_blank",
              data: { bs_dismiss: "offcanvas" } do %>
            <i class="bi bi-gear me-2"></i>ActiveAdmin
            <i class="bi bi-box-arrow-up-right ms-auto small"></i>
          <% end %>
        </li>
      </ul>
    </nav>
  </div>
</div>

<!-- Hamburger button (fixed mobile top) -->
<div class="d-lg-none position-fixed top-0 start-0 p-3" style="z-index: 1030;">
  <button class="btn btn-outline-secondary"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasSidebar"
          aria-label="Ouvrir le menu">
    <i class="bi bi-list"></i>
  </button>
</div>
