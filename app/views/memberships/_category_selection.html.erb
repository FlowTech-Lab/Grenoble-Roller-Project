<%# 
  Partial pour la sélection de catégorie
  Variables locales attendues:
  - f: l'objet form
  - categories: hash des catégories (@categories)
  - membership: objet membership pour pré-sélection (@membership)
  - form_id: ID du formulaire (pour les IDs uniques)
  - is_child: boolean pour adapter les textes
%>
<% form_id ||= "" %>
<% is_child ||= false %>

<div class="form-section" id="step-category<%= form_id %>">
  <h3 class="section-title">
    <span class="section-number">1</span>
    <% if is_child %>
      Choisissez l'adhésion
    <% else %>
      Choisissez votre adhésion
    <% end %>
  </h3>
  <p class="section-intro">
    <% if is_child %>
      Sélectionnez la formule qui correspond à votre enfant
    <% else %>
      Sélectionnez la formule qui vous correspond
    <% end %>
  </p>

  <div class="row g-3">
    <% categories.each do |key, cat| %>
      <div class="col-md-6">
        <label for="category_<%= key %><%= form_id %>" class="category-card <%= 'selected' if (membership&.category&.to_sym == key) || (key == :standard && membership.nil?) %>" onclick="selectCategory<%= form_id %>('<%= key %>')">
          <div class="category-title"><%= cat[:name] %></div>
          <div class="category-description">
            <% if key == :with_ffrs %>
              Je souhaite être membre bienfaiteur ou actif de l'association. Je souhaite également prendre la licence de la FFRS (Loisir). Plus d'informations sur <%= link_to('le site de la FFRS', 'https://ffroller-skateboard.fr/', target: '_blank', rel: 'noopener noreferrer', class: 'text-decoration-underline') %>.
            <% else %>
              <%= cat[:description] %>
            <% end %>
          </div>
          <div class="category-footer d-flex justify-content-between align-items-center mt-auto">
            <div class="category-select">
              <%= f.radio_button :category, key,
                  { class: "form-check-input", id: "category_#{key}#{form_id}", required: true, onchange: "updateCategorySelection#{form_id}()" } %>
              <span id="category_label_<%= key %><%= form_id %>">Sélectionner</span>
            </div>
            <div class="d-flex align-items-center gap-2">
              <div class="category-price">
                <%= number_to_currency(cat[:price_cents] / 100.0, unit: "€", separator: ",", delimiter: " ", format: "%n %u") %>
              </div>
              <% if key == :standard %>
                <span class="category-badge">
                  <i class="bi bi-star-fill me-1"></i>Best-seller
                </span>
              <% end %>
            </div>
          </div>
        </label>
      </div>
    <% end %>
  </div>
</div>
