<%# 
  Partial pour le questionnaire de santé
  Variables locales attendues:
  - f: l'objet form
  - form_id: ID du formulaire (pour les IDs uniques)
%>
<% form_id = form_id.presence || "" %>

<div class="card card-liquid mt-3">
  <div class="card-body">
    <div class="health-questions">
      <% health_questions = [
        { id: 'health_q1', text: "Un membre de votre famille a-t-il eu une mort subite ou inexpliquée ?" },
        { id: 'health_q2', text: "Avez-vous ressenti une douleur dans la poitrine, des palpitations ou un essoufflement lors d'un effort ?" },
        { id: 'health_q3', text: "Avez-vous eu un épisode de respiration sifflante (asthme) ?" },
        { id: 'health_q4', text: "Avez-vous eu une perte de connaissance ou une chute suite à un malaise ?" },
        { id: 'health_q5', text: "Si vous avez arrêté le sport 30 jours+, avez-vous repris sans l'avis d'un médecin ?" },
        { id: 'health_q6', text: "Avez-vous débuté un traitement médical de longue durée ?" },
        { id: 'health_q7', text: "Avez-vous des problèmes de santé survenus ces 12 derniers mois ?" },
        { id: 'health_q8', text: "Votre pratique sportive est-elle interrompue pour des raisons de santé ?" },
        { id: 'health_q9', text: "Pensez-vous avoir besoin d'un avis médical pour continuer le sport ?" }
      ] %>

      <% health_questions.each_with_index do |question, index| %>
        <div class="health-question-item py-3 <%= 'border-top' unless index == 0 %>" 
             style="<%= 'border-color: var(--card-border-color) !important;' unless index == 0 %>"
             data-question-number="<%= index + 1 %>">
          <div class="form-label fw-bold mb-2">
            Q<%= index + 1 %> : <%= question[:text] %>
          </div>
          <div class="d-flex gap-4">
            <div class="form-check">
              <% no_id = "#{question[:id]}_no#{form_id}" %>
              <%= f.radio_button "health_question_#{index + 1}", "no",
                  { class: "form-check-input", id: no_id } %>
              <label class="form-check-label" for="<%= no_id %>">
                Non
              </label>
            </div>
            <div class="form-check">
              <% yes_id = "#{question[:id]}_yes#{form_id}" %>
              <%= f.radio_button "health_question_#{index + 1}", "yes",
                  { class: "form-check-input", id: yes_id } %>
              <label class="form-check-label" for="<%= yes_id %>">
                Oui
              </label>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<!-- Message pour Standard avec réponse OUI -->
<div id="health_standard_yes_info<%= form_id %>" class="alert alert-info mt-3" style="display: none;">
  <i class="bi bi-info-circle me-2"></i>
  <strong>Consultez votre médecin avant de pratiquer</strong>
  <p class="mb-0 mt-2">Nous vous recommandons fortement de consulter votre médecin traitant avant de pratiquer le roller.</p>
</div>

<!-- Upload certificat médical (affiché si FFRS avec au moins une réponse = OUI) -->
<div id="health_certificate_upload<%= form_id %>" class="mt-4" style="display: none;">
  <div class="alert alert-warning mb-3">
    <i class="bi bi-exclamation-triangle me-2"></i>
    <strong>Certificat médical requis</strong>
    <p class="mb-0 mt-2">Pour la licence FFRS, un certificat médical est obligatoire si vous avez répondu "Oui" à au moins une question.</p>
  </div>

  <div class="card card-liquid" style="background: var(--liquid-glass-bg); border: 2px solid var(--card-border-color);">
    <div class="card-body">
      <div class="form-label fw-bold mb-3">
        <i class="bi bi-file-earmark-medical me-2"></i>
        Certificat médical *
      </div>

      <div class="file-upload-area" id="certificate_upload_area<%= form_id %>">
        <div class="file-upload-content">
          <i class="bi bi-cloud-upload fs-1 text-muted mb-3"></i>
          <p class="mb-2">
            <strong>Glissez-déposez votre certificat</strong> ou cliquez pour sélectionner
          </p>
          <p class="text-muted small mb-0">
            Formats acceptés : PDF, JPG, PNG (max 10 Mo)
          </p>
        </div>
            <%= f.file_field :medical_certificate,
                class: "form-control d-none",
                id: "medical_certificate_input#{form_id}",
                accept: ".pdf,.jpg,.jpeg,.png" %>
        <button type="button" class="btn btn-outline-primary mt-3" data-certificate-button="<%= form_id %>">
          <i class="bi bi-folder2-open me-2"></i>Sélectionner un fichier
        </button>
      </div>

      <div id="certificate_preview<%= form_id %>" class="mt-3" style="display: none;">
        <div class="d-flex align-items-center justify-content-between p-3 rounded" style="background: var(--liquid-glass-bg); border: 1px solid var(--card-border-color);">
          <div class="d-flex align-items-center">
            <i class="bi bi-file-earmark-pdf fs-3 text-danger me-3"></i>
            <div>
              <strong id="certificate_filename<%= form_id %>"></strong>
              <small class="text-muted d-block" id="certificate_filesize<%= form_id %>"></small>
            </div>
          </div>
          <button type="button" class="btn btn-sm btn-outline-danger" data-remove-certificate="<%= form_id %>">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>

      <div class="form-text small mt-2">
        <i class="bi bi-info-circle me-1"></i>
        Le certificat médical doit être valide et daté de moins de 6 mois
      </div>
    </div>
  </div>
</div>

<!-- Message pour Standard avec toutes réponses NON -->
<div id="health_standard_no_info<%= form_id %>" class="alert alert-success mt-3" style="display: none;">
  <i class="bi bi-check-circle me-2"></i>
  <strong>Parfait !</strong> Aucun problème de santé détecté. Vous pouvez continuer.
</div>

<!-- Message pour FFRS avec toutes réponses NON (attestation auto) -->
<div id="health_ffrs_no_info<%= form_id %>" class="alert alert-success mt-3" style="display: none;">
  <i class="bi bi-check-circle me-2"></i>
  <strong>Parfait !</strong> Aucun problème de santé détecté. Une attestation de santé sera générée automatiquement.
</div>
