<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-8">
      <div class="card card-liquid rounded-liquid shadow-liquid">
        <div class="card-body p-4">
          <!-- Header compact -->
          <div class="d-flex align-items-center justify-content-between mb-3 pb-3 border-bottom">
            <h1 class="h5 mb-0">
              <i class="bi bi-receipt-cutoff text-liquid-primary me-2"></i>
              Commande #<%= @order.id %>
            </h1>
            <% 
              status_btn = case @order.status.downcase
                when 'pending', 'en attente'
                  'btn-warning'
                when 'preparation', 'en préparation', 'preparing'
                  'btn-info'
                when 'sent', 'envoyé', 'shipped', 'finished', 'terminé'
                  'btn-success'
                when 'cancelled', 'annulé', 'canceled'
                  'btn-danger'
                else
                  'btn-success'
              end
            %>
            <button type="button" class="btn <%= status_btn %> btn-sm" disabled>
              <i class="bi <%= case @order.status.downcase
                when 'pending', 'en attente'
                  'bi-hourglass-split'
                when 'preparation', 'en préparation', 'preparing'
                  'bi-gear'
                when 'sent', 'envoyé', 'shipped'
                  'bi-truck'
                when 'cancelled', 'annulé', 'canceled'
                  'bi-x-circle'
                else
                  'bi-check-circle'
              end %> me-1"></i>
              <%= @order.status %>
            </button>
          </div>

          <!-- Order info compact -->
          <div class="d-flex flex-wrap align-items-center gap-3 small text-muted mb-3 pb-3 border-bottom">
            <div class="d-flex align-items-center gap-1">
              <i class="bi bi-calendar"></i>
              <span><%= l(@order.created_at, format: :short) %></span>
            </div>
            <span>•</span>
            <div class="d-flex align-items-center gap-1">
              <i class="bi bi-box-seam"></i>
              <span><%= @order.order_items.sum(:quantity) %> article(s)</span>
            </div>
            <span class="ms-auto fw-bold text-liquid-primary">
              <%= format_price(@order.total_cents) %>
            </span>
          </div>

          <!-- Order items -->
          <div class="mb-3">
            <h3 class="h6 text-liquid-primary mb-3">
              <i class="bi bi-list-ul me-2"></i>Articles
            </h3>
            
            <div class="mb-3">
              <% @order.order_items.each do |item| %>
                <div class="cart-item mb-2 pb-2 border-bottom">
                  <div class="cart-item-image">
                    <%= image_tag item.variant.product.image_url, alt: item.variant.product.name, loading: "lazy" %>
                  </div>
                  
                  <div class="cart-item-content">
                    <div class="cart-item-info">
                      <p class="cart-item-title mb-1"><%= item.variant.product.name %></p>
                      <div class="d-flex align-items-center gap-2">
                        <p class="small text-muted mb-0"><%= item.variant.sku %></p>
                        <span class="small text-muted">•</span>
                        <p class="small text-muted mb-0"><%= format_price(item.unit_price_cents) %> / u</p>
                      </div>
                    </div>
                    
                    <div class="cart-item-qty">
                      <span class="badge badge-liquid-primary">Qté: <%= item.quantity %></span>
                    </div>
                    
                    <div class="cart-item-price">
                      <div class="text-end">
                        <strong><%= format_price(item.unit_price_cents * item.quantity) %></strong>
                      </div>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>

            <!-- Total compact -->
            <div class="pt-2">
              <div class="d-flex justify-content-between align-items-center mt-1">
                <strong>Total:</strong>
                <strong class="text-liquid-primary"><%= format_price(@order.total_cents) %></strong>
              </div>
            </div>
          </div>

          <!-- Action buttons compact -->
          <div class="d-flex gap-2 flex-wrap pt-3 border-top">
            <%= link_to orders_path, class: "btn btn-outline-primary btn-sm" do %>
              <i class="bi bi-arrow-left me-1"></i>Retour
            <% end %>
            <%= link_to shop_path, class: "btn btn-outline-primary btn-sm" do %>
              <i class="bi bi-bag me-1"></i>Boutique
            <% end %>
            <% if ['pending', 'en attente', 'preparation', 'en préparation', 'preparing'].include?(@order.status.downcase) %>
              <%= button_to cancel_order_path(@order), 
                  method: :patch,
                  class: "btn btn-outline-danger btn-sm",
                  data: { 
                    confirm: "Êtes-vous sûr(e) de vouloir annuler cette commande ? Cette action est irréversible et le stock sera restauré.",
                    turbo_confirm: "Êtes-vous sûr(e) de vouloir annuler cette commande ? Cette action est irréversible et le stock sera restauré."
                  } do %>
                <i class="bi bi-x-circle me-1"></i>Annuler
              <% end %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
