<% content_for :description, "Découvrez la communauté Roller Grenobloise ! Participez à des événements, partagez vos sorties et connectez-vous avec d'autres riders à Grenoble. Randonnées urbaines, cours d'initiation, événements à thème." %>

<!-- Hero Banner -->
<div class="banner-hero mb-0">
    <div class="banner-overlay"></div>
    <div class="banner-content">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-8 text-center">
                    <i class="bi bi-roller-skate banner-icon mb-3"></i>
                    <h1 class="banner-title mb-4">
                        La communauté<br>Roller Grenobloise !
                    </h1>
                    <p class="banner-subtitle mb-4">
                        Découvrez nos événements, partagez vos sorties et connectez-vous<br>
                        avec d'autres riders à Grenoble
                    </p>
                    <div class="banner-actions">
                        <%= link_to events_path, class: "btn btn-liquid-primary btn-lg" do %>
                            <i class="bi bi-calendar-event me-2"></i>
                            Découvrir les événements
                        <% end %>
                        <% if !user_signed_in? %>
                        <%= link_to new_user_session_path, class: "btn btn-outline-light btn-lg" do %>
                            <i class="bi bi-box-arrow-in-right me-2"></i>
                            Connexion
                        <% end %>
                        <%= link_to new_user_registration_path, class: "btn btn-outline-light btn-lg" do %>
                            <i class="bi bi-person-plus me-2"></i>
                            S'inscrire
                        <% end %>
                        <% elsif !current_user.has_active_membership? %>
                        <%= link_to new_membership_path(check_age: true), class: "btn btn-outline-light btn-lg" do %>
                            <i class="bi bi-person-badge me-2" aria-hidden="true"></i>
                            Adhérer
                        <% end %>
                        <% end %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Ligne de séparation blanche (pleine largeur) -->
<div style="height: 2px; background: #ffffff; width: 100%;"></div>

<!-- Annonce Initiation du dimanche 14 décembre -->
<section class="py-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-10">
        <div class="alert alert-light border-0 shadow-lg mb-0" role="alert" style="border-radius: 15px;">
          <div class="d-flex flex-column flex-md-row align-items-center align-items-md-start gap-3">
            <div class="text-center text-md-start" style="flex-shrink: 0;">
              <i class="bi bi-calendar-check-fill text-primary" style="font-size: 3rem;"></i>
            </div>
            <div class="flex-grow-1 text-center text-md-start">
              <h3 class="h4 fw-bold mb-2 text-primary">
                <i class="bi bi-megaphone-fill me-2"></i>
                Initiation Roller - Dimanche 14 décembre
              </h3>
              <p class="mb-3 text-body-secondary">
                <strong>Heure d'équipement :</strong> 10h15-10h30<br>
                <strong>Heure de séance :</strong> 10h30-12h
              </p>
              <p class="mb-3 text-body-secondary">
                Pour vous inscrire à cette séance d'initiation, merci d'utiliser le formulaire Google ci-dessous.
                <br><small class="text-muted">* Merci de remplir le formulaire pour chaque participant. Si vous n'avez pas de matériel, merci de nous laisser votre pointure.</small>
              </p>
              <div class="d-flex flex-column flex-md-row gap-2 justify-content-center justify-content-md-start">
                <%= link_to "https://docs.google.com/forms/d/e/1FAIpQLSdqJYRWbdUXIM8pIgIT6JVLK7bu5LQID9SBC6pioqQYPOUyBw/viewform", 
                    target: "_blank", 
                    rel: "noopener noreferrer",
                    class: "btn btn-primary btn-lg" do %>
                  <i class="bi bi-google me-2"></i>
                  S'inscrire via le formulaire Google
                <% end %>
                <%= link_to initiations_path, class: "btn btn-outline-primary btn-lg" do %>
                  <i class="bi bi-calendar-event me-2"></i>
                  Voir toutes les initiations
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Ligne de séparation blanche (pleine largeur) -->
<div style="height: 2px; background: #ffffff; width: 100%;"></div>

<!-- Section À propos -->
<section class="py-5 section-alt">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8 text-center">
        <h2 class="h3 fw-bold mb-3">
          <i class="bi bi-heart-fill text-liquid-primary me-2" aria-hidden="true"></i>
          À propos de Grenoble Roller
        </h2>
        
        <!-- Ligne de séparation blanche -->
        <div style="height: 2px; background: #ffffff; width: 100%; max-width: 200px; margin: 0 auto 1.5rem;"></div>
        
        <p class="lead text-body-secondary mb-4">
          Association à but non lucrative, nous organisons des randonnées urbaines 
          encadrées ainsi que des cours de roller pour favoriser le lien social dans un 
          esprit convivial et sportif. Rejoignez une communauté passionnée depuis plus 
          Rejoignez une communauté passionnée depuis plus de 20 ans !
        </p>
        <%= link_to about_path, class: "btn btn-liquid-primary" do %>
          <i class="bi bi-arrow-right-circle me-2" aria-hidden="true"></i>
          En savoir plus sur l'association
        <% end %>
      </div>
    </div>
  </div>
</section>

<!-- Ligne de séparation blanche (pleine largeur) -->
<div style="height: 2px; background: #ffffff; width: 100%;"></div>

<section class="container pb-5 pt-4">
  <% if @highlighted_event.present? %>
    <div class="mb-5">
      <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-md-between mb-4">
        <div class="d-flex align-items-center gap-2 mb-2 mb-md-0">
          <i class="bi bi-star-fill text-warning fs-5"></i>
          <h2 class="h3 fw-bold mb-0">Prochain rendez-vous</h2>
        </div>
        <%= link_to events_path, class: "btn btn-outline-primary btn-sm" do %>
          <i class="bi bi-calendar-event me-1"></i>
          Voir tous les événements
        <% end %>
      </div>
      
      <div class="row justify-content-center">
        <div class="col-12 col-lg-10 col-xl-8">
          <article class="card card-event card-event-featured card-liquid rounded-liquid shadow-liquid overflow-hidden">
            <div class="card-event-image card-event-image-featured">
              <% if @highlighted_event.cover_image.attached? %>
                <%= image_tag(rails_representation_path(@highlighted_event.cover_image_card_featured), alt: @highlighted_event.title, loading: 'lazy', class: 'w-100 h-100 object-fit-cover') %>
              <% end %>
              <span class="card-event-date badge badge-liquid-success">
                <i class="bi bi-calendar3 me-1"></i>
                <%= l @highlighted_event.start_at, format: :day_month, locale: :fr %>
              </span>
            </div>

            <div class="card-body p-3 p-md-4 p-lg-5">
              <!-- En-tête avec titre et badges de statut -->
              <header class="mb-4">
                <h2 class="card-title h3 fw-bold mb-3">
                  <%= link_to @highlighted_event.title, event_path(@highlighted_event), class: 'text-decoration-none text-body' %>
                </h2>

                <!-- Badges de statut groupés (route, durée) -->
                <div class="d-flex flex-wrap align-items-center gap-2 mb-3">
                  <% if @highlighted_event.route.present? %>
                    <span class="badge bg-body-secondary text-body-secondary">
                      <i class="bi bi-geo-alt me-1"></i><%= @highlighted_event.route.name %>
                    </span>
                  <% end %>
                  <span class="badge bg-body-secondary text-body-secondary">
                    <i class="bi bi-clock me-1"></i><%= @highlighted_event.duration_min %> min
                  </span>
                </div>

                <!-- Badges d'inscription (essentiels) -->
                <% attendance_count = @highlighted_event.attendances_count %>
                <% is_full = @highlighted_event.full? %>
                <% is_unlimited = @highlighted_event.unlimited? %>
                <% remaining_spots = @highlighted_event.remaining_spots %>
                <div class="d-flex flex-wrap gap-2 mb-4">
                  <span class="badge bg-primary">
                    <i class="bi bi-people-fill me-1"></i>
                    <%= pluralize(attendance_count, "inscrit") %>
                  </span>
                  
                  <% unless is_unlimited %>
                    <% if is_full %>
                      <span class="badge bg-danger">
                        <i class="bi bi-x-circle me-1"></i>Complet
                      </span>
                    <% else %>
                      <span class="badge bg-success">
                        <i class="bi bi-check-circle me-1"></i><%= pluralize(remaining_spots, "place disponible") %>
                      </span>
                    <% end %>
                  <% else %>
                    <span class="badge bg-info">
                      <i class="bi bi-infinity me-1"></i>Illimité
                    </span>
                  <% end %>
                  
                  <% if user_signed_in? && current_user_has_attendance?(@highlighted_event) %>
                    <span class="badge bg-success">
                      <i class="bi bi-check-circle me-1"></i>Vous êtes inscrit(e)
                    </span>
                  <% end %>
                </div>
              </header>

              <!-- Informations essentielles (What, When, Where) -->
              <section class="event-details-section mb-4">
                <div class="detail-row">
                  <div class="detail-icon">
                    <i class="bi bi-calendar-event"></i>
                  </div>
                  <div class="detail-content">
                    <p class="detail-label">Quand</p>
                    <p class="detail-value">
                      <strong><%= l @highlighted_event.start_at, format: :event_long, locale: :fr %></strong>
                    </p>
                  </div>
                </div>

                <div class="detail-row">
                  <div class="detail-icon">
                    <i class="bi bi-geo-alt"></i>
                  </div>
                  <div class="detail-content">
                    <p class="detail-label">Lieu</p>
                    <p class="detail-value"><%= @highlighted_event.location_text %></p>
                  </div>
                </div>
              </section>

              <!-- Description tronquée à 150 caractères avec "Lire la suite" -->
              <div class="event-description mb-4">
                <p class="text-body-secondary mb-0">
                  <%= truncate(@highlighted_event.description, length: 150, omission: '...') %>
                </p>
                <% if @highlighted_event.description.length > 150 %>
                  <%= link_to event_path(@highlighted_event), class: 'btn btn-link text-decoration-none p-0 mt-2', aria: { label: 'Lire la suite de la description' } do %>
                    Lire la suite <i class="bi bi-arrow-right ms-1"></i>
                  <% end %>
                <% end %>
              </div>

              <!-- Actions avec hiérarchie claire -->
              <div class="event-actions">
                <!-- Bouton primaire séparé et proéminent -->
                <% if user_signed_in? %>
                  <% if current_user_has_attendance?(@highlighted_event) %>
                    <div class="d-grid mb-3">
                      <%= button_to cancel_attendance_event_path_for(@highlighted_event), method: :delete, 
                          class: 'btn btn-outline-secondary btn-lg', 
                          data: { turbo_confirm: 'Annuler votre inscription ? Vous pouvez vous réinscrire plus tard si vous le souhaitez.' },
                          aria: { label: 'Se désinscrire de cet événement' } do %>
                        <i class="bi bi-calendar-x me-2"></i>Se désinscrire
                      <% end %>
                    </div>
                  <% elsif policy(@highlighted_event).can_attend? && !is_full %>
                    <div class="d-grid mb-3">
                      <button type="button" 
                              class="btn btn-liquid-primary btn-lg" 
                              data-bs-toggle="modal" 
                              data-bs-target="#confirmAttendModalHomepage"
                              aria-label="S'inscrire à cet événement">
                        <i class="bi bi-calendar-plus me-2"></i>S'inscrire maintenant
                      </button>
                    </div>
                  <% elsif is_full %>
                    <div class="d-grid mb-3">
                      <button type="button" class="btn btn-outline-secondary btn-lg" disabled aria-label="Événement complet">
                        <i class="bi bi-x-circle me-2"></i>Complet
                      </button>
                    </div>
                  <% end %>
                <% else %>
                  <div class="d-grid mb-3">
                    <%= link_to new_user_session_path, 
                        class: 'btn btn-liquid-primary btn-lg',
                        aria: { label: 'Se connecter pour s\'inscrire à cet événement' } do %>
                      <i class="bi bi-box-arrow-in-right me-2"></i>Se connecter pour s'inscrire
                    <% end %>
                  </div>
                <% end %>

                <!-- Boutons secondaires groupés -->
                <div class="d-flex flex-wrap gap-2">
                  <% if user_signed_in? %>
                    <%= link_to event_path(@highlighted_event, format: :ics), 
                        class: 'btn btn-outline-primary', 
                        title: 'Télécharger le fichier .ics pour l\'ajouter à votre calendrier', 
                        data: { bs_toggle: 'tooltip', bs_placement: 'top' },
                        aria: { label: 'Ajouter au calendrier' } do %>
                      <i class="bi bi-calendar-event me-2"></i>Calendrier
                    <% end %>
                  <% else %>
                    <%= link_to new_user_session_path, 
                        class: 'btn btn-outline-primary',
                        aria: { label: 'Se connecter pour accéder aux fonctionnalités' } do %>
                      <i class="bi bi-box-arrow-in-right me-2"></i>Se connecter
                    <% end %>
                  <% end %>

                  <%= link_to event_path(@highlighted_event), 
                      class: 'btn btn-outline-secondary',
                      aria: { label: 'Voir les détails de cet événement' } do %>
                    <i class="bi bi-eye me-2"></i>Voir plus
                  <% end %>

                  <% if user_signed_in? && policy(@highlighted_event).edit? %>
                    <%= link_to edit_event_path(@highlighted_event), 
                        class: 'btn btn-link text-decoration-none',
                        aria: { label: 'Modifier cet événement' } do %>
                      <i class="bi bi-pencil-square me-1"></i>Modifier
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          </article>
        </div>
      </div>

      <% if user_signed_in? && policy(@highlighted_event).can_attend? && !is_full %>
        <!-- Modal de confirmation d'inscription -->
        <div class="modal fade" id="confirmAttendModalHomepage" tabindex="-1" aria-labelledby="confirmAttendModalHomepageLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h2 class="modal-title h5" id="confirmAttendModalHomepageLabel">
                  <i class="bi bi-calendar-check me-2"></i>Confirmer votre inscription
                </h2>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
              </div>
              <%= form_with url: attend_event_path_for(@highlighted_event), method: :post, data: { turbo: false } do |f| %>
                <div class="modal-body">
                  <p class="lead mb-3">
                    Confirmez votre participation à <strong><%= @highlighted_event.title %></strong>
                  </p>
                  
                  <!-- Sélection enfant si applicable -->
                  <% if user_signed_in? %>
                    <% child_memberships = current_user.memberships.active_now.where(is_child_membership: true) %>
                    <% if child_memberships.any? %>
                      <div class="mb-3">
                        <%= f.label :child_membership_id, "S'inscrire pour un enfant (optionnel)", class: "form-label" %>
                        <%= f.collection_select :child_membership_id, 
                            child_memberships, 
                            :id, 
                            ->(m) { "#{m.child_first_name} #{m.child_last_name}" }, 
                            { prompt: "S'inscrire pour moi-même" }, 
                            { class: "form-select" } %>
                        <small class="text-muted">Laissez vide pour vous inscrire vous-même</small>
                      </div>
                    <% end %>
                  <% end %>
                  
                  <div class="form-check mb-3">
                    <%= f.check_box :wants_reminder, { checked: true, class: 'form-check-input' }, '1', '0' %>
                    <label class="form-check-label" for="wants_reminder">
                      <i class="bi bi-bell me-1"></i>
                      Recevoir un rappel par email la veille à 19h
                    </label>
                  </div>
                  
                  <p class="mb-0 text-muted small">
                    <i class="bi bi-info-circle me-1"></i>
                    Vous recevrez une confirmation par email et pourrez annuler votre inscription à tout moment.
                  </p>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Annuler</button>
                  <%= f.submit "Confirmer l'inscription", class: "btn btn-liquid-primary", data: { bs_dismiss: "modal" } %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-5 mb-5">
      <div class="card card-liquid rounded-liquid shadow-liquid p-5">
        <i class="bi bi-calendar-x text-muted" style="font-size: 3rem;"></i>
        <h3 class="h4 fw-bold mt-3 mb-2">Aucun événement à venir</h3>
        <p class="text-body-secondary mb-4">
          Les prochains événements apparaîtront ici dès qu'ils seront programmés.
        </p>
        <%= link_to events_path, class: "btn btn-liquid-primary" do %>
          <i class="bi bi-calendar-event me-2"></i>
          Voir tous les événements
        <% end %>
      </div>
    </div>
  <% end %>
</section>

<!-- Pourquoi nous rejoindre ? (version minimaliste) -->
<section class="py-4 mb-4">
  <div class="container">
    <h2 class="h3 fw-bold text-center mb-4">
      <i class="bi bi-heart-fill text-liquid-primary me-2" aria-hidden="true"></i>
      Pourquoi nous rejoindre ?
    </h2>

    <div class="row g-3">
      <div class="col-md-4">
        <div class="card card-liquid rounded-liquid shadow-sm h-100 border-0">
          <div class="card-body text-center py-4">
            <i class="bi bi-people fs-1 text-liquid-primary mb-3" aria-hidden="true"></i>
            <h3 class="h6 fw-bold mb-2">Tous niveaux</h3>
            <p class="small text-body-secondary mb-0">
              Débutants et experts trouvent leur place
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card card-liquid rounded-liquid shadow-sm h-100 border-0">
          <div class="card-body text-center py-4">
            <i class="bi bi-shield-check fs-1 text-liquid-success mb-3" aria-hidden="true"></i>
            <h3 class="h6 fw-bold mb-2">Sécurité</h3>
            <p class="small text-body-secondary mb-0">
              Parcours et initiations encadrés par des staffeurs formés
            </p>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card card-liquid rounded-liquid shadow-sm h-100 border-0">
          <div class="card-body text-center py-4">
            <i class="bi bi-calendar-heart fs-1 text-liquid-danger mb-3" aria-hidden="true"></i>
            <h3 class="h6 fw-bold mb-2">20+ ans</h3>
            <p class="small text-body-secondary mb-0">
              Association active depuis 2005
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center mt-4">
      <%= link_to about_path, class: "btn btn-outline-liquid-primary" do %>
        <i class="bi bi-arrow-right-circle me-2" aria-hidden="true"></i>
        En savoir plus
      <% end %>
    </div>
  </div>
</section>

<!-- Chiffres clés (version simplifiée) -->
<section class="py-4 mb-4 section-alt">
  <div class="container">
    <div class="row g-3 text-center">
      <div class="col-6 col-md-3">
        <div class="p-3">
          <div class="display-5 fw-bold text-liquid-primary"><%= @users_count %></div>
          <p class="small text-body-secondary mb-0">Membres actifs</p>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="p-3">
          <div class="display-5 fw-bold text-liquid-success"><%= @events_count %></div>
          <p class="small text-body-secondary mb-0">Événements organisés</p>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="p-3">
          <div class="display-5 fw-bold text-liquid-warning"><%= @upcoming_events_count %></div>
          <p class="small text-body-secondary mb-0">À venir</p>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="p-3">
          <div class="display-5 fw-bold text-liquid-info"><%= @attendances_count %></div>
          <p class="small text-body-secondary mb-0">Inscriptions</p>
        </div>
      </div>
    </div>
  </div>
</section>