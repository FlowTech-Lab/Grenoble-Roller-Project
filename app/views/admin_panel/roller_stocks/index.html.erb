<% 
  breadcrumb_items = [
    { label: "Stock Rollers", url: nil }
  ]
%>

<%= render 'admin_panel/shared/breadcrumb', breadcrumb_items: breadcrumb_items %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Stock Rollers</h1>
  <%= link_to "Nouveau stock", new_admin_panel_roller_stock_path, class: "btn btn-primary" %>
</div>

<!-- Filtres -->
<div class="card mb-4">
  <div class="card-body">
    <%= search_form_for @q, url: admin_panel_roller_stocks_path, method: :get, class: "row g-3" do |f| %>
      <div class="col-md-3">
        <%= f.label :is_active_eq, "Statut", class: "form-label" %>
        <%= f.select :is_active_eq,
            options_for_select([
              ["Tous", ""],
              ["Actifs", true],
              ["Inactifs", false]
            ], params.dig(:q, :is_active_eq)),
            {},
            { class: "form-select" } %>
      </div>
      <div class="col-md-3">
        <label class="form-label">Scope</label>
        <%= select_tag :scope,
            options_for_select([
              ["Tous", ""],
              ["Disponibles", "available"]
            ], params[:scope]),
            { class: "form-select" } %>
      </div>
      <div class="col-md-4 d-flex align-items-end gap-2">
        <%= f.submit "Filtrer", class: "btn btn-outline-primary" %>
        <%= link_to "Réinitialiser", admin_panel_roller_stocks_path, class: "btn btn-outline-secondary" %>
      </div>
    <% end %>
  </div>
</div>

<!-- Tableau Stock -->
<div class="card mb-4">
  <div class="card-body">
    <% if @roller_stocks.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Taille (EU)</th>
              <th>Quantité</th>
              <th>Statut</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @roller_stocks.each do |stock| %>
              <tr>
                <td><strong><%= stock.size %></strong></td>
                <td>
                  <% if stock.quantity > 0 %>
                    <span class="badge bg-success"><%= stock.quantity %></span>
                  <% else %>
                    <span class="badge bg-danger">0</span>
                  <% end %>
                </td>
                <td>
                  <% if stock.is_active? %>
                    <span class="badge bg-success">Actif</span>
                  <% else %>
                    <span class="badge bg-secondary">Inactif</span>
                  <% end %>
                </td>
                <td>
                  <div class="btn-group btn-group-sm">
                    <%= link_to "Voir", admin_panel_roller_stock_path(stock), class: "btn btn-outline-primary" %>
                    <%= link_to "Éditer", edit_admin_panel_roller_stock_path(stock), class: "btn btn-outline-secondary" %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      
      <!-- Pagination -->
      <div class="mt-3">
        <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>
      </div>
    <% else %>
      <div class="alert alert-info">
        Aucun stock trouvé.
      </div>
    <% end %>
  </div>
</div>

<!-- Demandes en attente -->
<% if @pending_requests.any? %>
  <div class="card">
    <div class="card-header">
      <h5 class="mb-0">Demandes en attente</h5>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-sm">
          <thead>
            <tr>
              <th>Nom</th>
              <th>Email</th>
              <th>Taille demandée</th>
              <th>Initiation</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            <% @pending_requests.each do |attendance| %>
              <tr>
                <td><%= attendance.participant_name %></td>
                <td><%= attendance.user.email %></td>
                <td><strong><%= attendance.roller_size %></strong></td>
                <td><%= attendance.event.title %></td>
                <td><%= l(attendance.created_at, format: :short) %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
<% end %>
